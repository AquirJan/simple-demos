<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawer</title>
  <script src="./popTip.js"></script>
  <script src="./mousePosition.js"></script>
  <script src="./sbBoard.js"></script>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }
    ul li {
      list-style: none;
    }
    .canvas {
      user-select: none;
      /* position: absolute; */
    }
    .tool-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      z-index: 1;
      text-align:center;
    }
    .tools-list {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .tools-list-item {
      padding: 4px 8px;
    }
    body {
      /* display: grid;
      align-items: center;
      justify-content: center;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0; */
    }
    button{
      border: 1px solid #345;
      padding: 4px 8px;
      font-size: 1rem;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="tool-bar">
    <ul class="tools-list">
      <!-- 指针 -->
      <!-- <li class="tools-list-item">
        <button id="pointer">pointer</button>
      </li> -->
      <!-- 获取数据 -->
      <li class="tools-list-item">
        <button id="getData">getData</button>
      </li>
      <!-- 多边形 -->
      <li class="tools-list-item">
        <button id="polygon">polygon</button>
      </li>
      <!-- 小图 -->
      <li class="tools-list-item">
        <button id="pcbSmall">pcbSmall</button>
      </li>
      <!-- 圆形 -->
      <!-- <li class="tools-list-item">
        <button id="circle">circle</button>
      </li> -->
      <!-- 矩形 -->
      <li class="tools-list-item">
        <button id="rect">rect</button>
      </li>
      <!-- 设置图片 -->
      <li class="tools-list-item">
        <button id="setBg">setBg</button>
      </li>
      <!-- 清除 -->
      <li class="tools-list-item">
        <button id="clear">clear</button>
      </li>
      <!-- 缩小 -->
      <li class="tools-list-item">
        <button id="zoomOut">zoomOut</button>
      </li>
      <!-- 放大 -->
      <li class="tools-list-item">
        <button id="zoomIn">zoomIn</button>
      </li>
      <!-- 还原缩放 -->
      <li class="tools-list-item">
        <button id="zoomReset">zoomReset</button>
      </li>
    </ul>
  </div>
  <script>
    new mousePosition()

    function bindEvent(btnId, cb) {
      const restoreBtn = document.getElementById(btnId)
      restoreBtn.addEventListener('click', (e)=>{
        cb()
      })
    }

    const _sbBoard = new sbBoard({
      wrapStyle:{
        position: 'absolute',
      },
      pencilStyle: {
        strokeStyle: 'red',
        lineWidth: 3
      },
      // drawHistory: [{"dx":1774,"dy":1842,"height":608,"id":"c43ae412-7580-482a-bcfc-f6be9121145d","type":"rect","width":101,"x":1673,"y":1234},{"x":2261,"y":2089,"dx":2345,"dy":2189,"width":87,"height":106,"type":"rect","id":"f13bdb2b-4d0d-4093-a401-b25d2e674aa3"},{"x":2145,"y":1737,"dx":2280,"dy":1911,"width":135,"height":174,"type":"rect","id":"7e4c3515-5c28-4096-90b3-2ed7c86317bb"},{"x":2602,"y":1135,"dx":2740,"dy":1289,"width":138,"height":154,"type":"rect","id":"2e5320bd-a6db-46e0-b003-4a40b08ea3ce"}],
      width: window.innerWidth,
      height: window.innerHeight
    })
    // _sbBoard.setDrawType('polygon')
    _sbBoard.setDrawsData([{"x":2099,"y":2103,"ways":[{"x":2852,"y":1857},{"x":2384,"y":1453},{"x":2010,"y":1478}],"type":"polygon","closed":true,"id":"1dc90d17-d563-4aff-87be-4d18631ace30","width":0,"height":0},{"x":1690,"y":2261,"width":340,"height":217,"type":"rect","id":"68884ea5-f4f8-4554-9fde-899984dd2b37"}])
    _sbBoard.setBackground({src:'./pcb_demo.jpg'})
    document.body.appendChild(_sbBoard.getWrapDom())
    _sbBoard.getCanvasDom().addEventListener('click', ()=>{
      const selectedDraw = _sbBoard.getSelectedDraw()
      console.log(selectedDraw)
    })
    // let scaled = false;
    // const scaleBtn = document.getElementById('scale')
    // scaleBtn.addEventListener('click', (e)=>{
    //   ctx.clearRect(0, 0, canvasWrap.width, canvasWrap.height);
    //   if (!scaled) {
    //     ctx.scale(2, 2);
    //   } else {
    //     ctx.scale(0.5, 0.5);
    //   }
    //   scaled = !scaled
    // })

    // const restoreBtn = document.getElementById('restore')
    // restoreBtn.addEventListener('click', (e)=>{
    //   console.log('restore button')
    // })

    bindEvent('clear', ()=>{
      console.log('clear whole')
      _sbBoard.clearWhole()
    })
    bindEvent('zoomIn', ()=>{
      console.log('zoomIn')
      _sbBoard.zoomIn()
    })
    bindEvent('zoomOut', ()=>{
      console.log('zoomOut')
      _sbBoard.zoomOut()
    })
    bindEvent('zoomReset', ()=>{
      console.log('zoomReset')
      _sbBoard.zoomReset()
    })
    bindEvent('rect', ()=>{
      console.log('rect')
      _sbBoard.setDrawType('rect')
    })
    // bindEvent('pointer', ()=>{
    //   console.log('pointer')
    //   _sbBoard.setDrawType('pointer')
    // })
    bindEvent('polygon', ()=>{
      console.log('polygon')
      _sbBoard.setDrawType('polygon')
    })
    // bindEvent('circle', ()=>{
    //   console.log('circle')
    //   _sbBoard.setDrawType('circle')
    // })
    bindEvent('setBg', ()=>{
      console.log('setBg')
      _sbBoard.setBackground({src:'./pcb_demo.jpg'})
      _sbBoard.setDrawsData([{"x":2099,"y":2103,"ways":[{"x":2852,"y":1857},{"x":2384,"y":1453},{"x":2010,"y":1478}],"type":"polygon","closed":true,"id":"1dc90d17-d563-4aff-87be-4d18631ace30","width":0,"height":0}])
      _sbBoard.zoomReset()
    })
    bindEvent('pcbSmall', ()=>{
      console.log('pcbSmall')
      _sbBoard.setBackground({src:'./pcb_small.png'})
      _sbBoard.setDrawsData([{"x":374,"y":380,"width":57,"height":64,"type":"rect","id":"5d0ae6e9-d18b-4973-a071-7eca7761652c"}])
      _sbBoard.zoomReset()
    })
    bindEvent('getData', ()=>{
      console.log('getData')
      console.log(JSON.stringify(_sbBoard.getDrawsData())) 
    })

    
    // const canvas = document.getElementById('canvas')
    // const image = new Image();
    // image.src = './pcb_demo.jpg';
    // image.onload = () => {
    //   canvas.width = image.naturalWidth
    //   canvas.height = image.naturalHeight
    //   canvas.getContext('2d').drawImage(image, 0, 0, canvas.width, canvas.height)
    // }

    // let aaa = [{"dx":907.2,"dy":452.4,"height":118.8,"id":"c43ae412-7580-482a-bcfc-f6be9121145d","type":"rect","width":168,"x":739.2,"y":333.6,"selected":false}]
    // const bbb = aaa.slice(0, aaa.length) 
    // bbb[0].dx = 0
    // console.log(aaa, bbb)
  </script>
</body>
</html>